---
layout: post
title: 5장 설명과 예측-프로파일링과 예측 모델링
# image: 
#   path: /assets/img/blog/jeremy-bishop@0,5x.jpg
description: >
  프로파일링과 예측 모델링 관련 내용 정리한 글입니다.
sitemap: false
---

<!-- Version 9 is the most complete version of Hydejack yet.
{:.lead}

[Modernized](#linking-in-style) [design](#whats-in-the-cards), [big headlines](#ready-for-the-big-screen), big new features: [Built-In Search](#built-in-search), [Sticky Table of Contents](#sticky-table-of-contents), and [Auto-Hiding Navbar](#auto-hiding-navbar). That [and more](#and-much-more) is Hydejack 9.

- Table of Contents
{:toc .large-only} -->

## 방향성 데이터마이닝 모형들

방향성 데이터마이닝은 우리가 알고 있는 **지도학습**으로써 목표변수에 관한 추론을 하기 위한 모형을 만드는 것과 관련이 있어요. 방향성 데이터마이닝에 대해 
자세히 살펴보려고 합니다.

### 모형 구조와 목표의 정의

방향성 데이터마이닝은 **<span style='color:blue'>목표변수</span>**에 대한 이해와 정의가 필요합니다. 캠페인을 위한 고객을 선택하는 모형이 방향성 데이터마이닝의
예시라고 할 수 있습니다. 이러한 예시를 그림으로 표현하면 아래와 같습니다. 

<img width="508" alt="image" src="https://user-images.githubusercontent.com/107903417/230749749-642174d1-1f43-465d-b83f-96bb9e2ed0cd.png">

증분 응답 모형의 기본적인 아이디어를 그림으로 표현하면 아래와 같습니다. 

<img width="417" alt="image" src="https://user-images.githubusercontent.com/107903417/230750028-9cb072c3-71af-4f18-9cc4-801acea63415.png">

### 모형 **<span style='color:blue'>안정성(Stability)</span>**

우리가 모형을 만드는 목표는 실험실에서 잘 작동하도록 하는 것보다, 실제 상황에서 잘 작동하도록 만드는 것입니다. 이러한 관점에서 **모형 안정성**은 모형이 
모형 뿐 아니라 만나보지 못했던 데이터에서도 잘 작동하는 능력이라고 할 수 있어요. 이러한 모형 안정성을 저해하는 요소는 아래와 같이 4가지가 있습니다. 
- 잘못된 문제를 풀었을 때 : 한 엔지니어링 팀은 미터 단위를 사용하고, 다른 팀은 영국 단위를 사용한 사례
- 과적합(overfitting) : 일반적인 패턴을 인식하는 대신 모형집합을 암기해버리는 현상
- 표본 편향 : 모형 집합이 원래 데이터로부터 임의 표본을 만들지 못했을 때 발생함.
- 미래와 과거가 같지 않음

## 모형 집합의 시간 프레임

모형 집합의 모든 변수는 변수가 기여한 기간과 관련된 **시간 프레임**을 가지고 있습니다. 입력변수와 목표변수 모두 시간 프레임을 가지고 있으며, 
이들의 관계는 매우 중요합니다. 입력변수들이 출력변수보다 앞선 시간 프레임에서 발생하는 경우를 **예측 모형**이라 합니다. 그리고 입력변수와 
출력변수가 동일한 시간 프레임에서 산출된다면, 이는 **프로파일링**모형이라 할 수 있습니다. 이를 그림으로 표현하며 아래와 같습니다.

<img width="401" alt="image" src="https://user-images.githubusercontent.com/107903417/230778901-509e40f6-3baf-4516-a7fc-f0cb895c72c9.png">

### 예측 모형

예측 모형은 앞에서 언급하였듯이 입력변수들이 모두 목표변수 이전에 산출되고 있습니다. 이러한 예측 과제에서 **모형 집합을 생성**하는 데 상당한 작업이 필요합니다.

### 프로파일링 모형

프로파일링 모형은 앞서 언급하였듯이 목표변수와 입력변수가 동일한 시간 프레임인 경우 해당되며, 원인과 결과의 구분이 어렵다는 특징이 있어요.

## 설명모델과 예측모델의 모델링

### 설명모델

**설명모델**에서는 **<span style='color:red'>데이터를 잘 적합시키는 모델</span>**을 **좋은 모델**이라고 합니다. 모델링을 할 때 데이터를 사용할 때 보통 **전체 데이터세트**를 사용합니다. 이러한 이유는 모집단에 가정된 관계에 대한 정보를 최대로 반영한 최적의 적합 모델을 추정하기 때문입니다. 또한 모델에 대한 **성능 측정**을 실시하게 됩니다. 성능을 측정할 때 유념해야 할 점은 **데이터가 모델에 얼마나 잘 적합한지**, 그리고 **평균 관계가 얼마나 강한지** 등이 있습니다.

## 예측모델

예측모델에서는 **<span style='color:red'>새로운 사례를 정확하게 예측하는 모델</span>**을 **좋은 모델**이라고 합니다. 예측모델에서는 데이터를 아래와 같이 2가지로 
분리하고 있습니다. 
- 학습 데이터 : 모델을 추정하는 데 사용
- 검증 데이터 : 예측 모델의 성능평가 시 사용

예측모델의 성능을 측정할 때 유념해야 할 점은 **예측의 정확도** 등이 있습니다.

## 방향성 데이터마이닝 방법론

데이터마이닝 방법론은 **11단계**로 구성되어 있으며, 아래 그림과 같이 선형 프로세스가 아니라는 것을 알 수 있어요.

<img width="415" alt="image" src="https://user-images.githubusercontent.com/107903417/231475950-8fcd1150-03ff-4295-9bae-bae3c905c399.png">

## 1단계:경영 문제를 데이터마이닝 문제로 번역한다.

데이터마이닝 프로젝트의 올바른 목적은 **<span style='color:red'>제대로 정의된 경영 문제</span>**를 해결하는 것입니다. 데이터마이닝 프로젝트의 목표들은
광범위하고 일반적이지 않아야 합니다.
- 광범위하고 일반적인 목표 예시
  - 고객들의 행동에 대한 이해, 데이터에서 의미있는 것의 발견 등

이러한 광범위한 목표들을 **<span style='color:blue'>작은 목표들로 세분화</span>**될 필요가 있어요. 세분화된 목표의 예시는 아래와 같습니다.
- 구독을 갱신하지 않을 가능성이 높은 고객들의 식별
- 와인과 맥주 판매를 중단할 경우, 판매가 줄어들 상품 추출 등

## 2단계:적절한 데이터를 선택한다.

### 무엇이 사용 가능한가

데이터를 찾기 전 가장 먼저 확인애햐 할 곳은 바로 **데이터웨어하우스**입니다. 실제로 문서의 내용이 빠져있거나 지나가버린 데이터가 있어서 쓸모없게 되는 등의 이유로 인해 데이터마이닝에서 사용가능한 데이터를 결정하는데 어려움을 많이 겪고 있어요. 사용가능한 데이터를 파악하기 위해서는 **데이터 사전 검토**, **사용자와 데이터베이스 관리자들 면담**, 그리고 **관련 보고서 검토** 등을 해야 합니다.

### 얼마만큼의 데이터가 충분할까?

소제목의 질문에 대한 단순한 대답은 존재하지 않습니다. 이 질문에 대한 대답은 사용할 특정 알고리즘, 데이터의 복잡성, 그리고 예상되는 결과 등에 의존하고 있어요. 통계학자들은 모형을 만들기 위한 최소한의 모형 집합을 결정하는 방법을 연구하고 있습니다. 상업적 세계에서는 데이터의 분량은 큰 의미가 없습니다.

데이터가 실제로 부족한 상황에서는 데이터마이닝의 효과와 유용성이 떨어지는 것을 알 수 있습니다. 
데이터마이닝에서 데이터는 다다익선이지만 목표변수 값이 흔치 않은 경우(신용카드 가입자가 사기를 치는 행위 등)이 있을 때 **<span style='color:blue'>균형 표본(balanced sample)</span>**이 필요합니다. 데이터의 양이 많게 되면 데이터마이너의 시간을 소모하며, 실행과정이 길어져 생산성이 낮아지는 결과를 초래하게 됩니다.

### 얼마나 먼 과거까지의 기록이 요구되는가

이 질문도 위에서 언급한 질문처럼 단순히 대답할 수 있는 문제는 아닙니다. 이에 대해서 먼저 고려해야할 것은 **<span style='color:blue'>계절성(seasonality)</span>**입니다. 즉, 주기적인 경향을 파악하기 위해 충분한 과거 데이터가 필요하다는 것입니다. 하지만 지나치게 먼 과거의 데이터는 시장의 변화를 반영하지 못하기 때문에 효용성이 떨어지므로, 이에 유의해야 합니다.

### 몇 개의 변수를 사용?

변수를 선택할 때 흥미없는 변수를 미리 버리는 행위는 데이터마이닝 접근법에 적절하지 않습니다. 왜냐하면 미리 버린 변수들이 종종 다른 변수들과 함께 쓰였을 때 예측적인 가치를 발휘하기 때문이지요. 최종 모형은 보통 몇 안되는 변수들로 구성되나, 이렇게 적은 변수들은 다른 변수들의 조합들로 도출되고 있습니다.

### 무방향성 데이터마이닝(비지도학습)

무방향성 데이터마이닝은 **목표변수를 사용하지 않는(적어도 명시적으로)** 유형을 가리킵니다. 무방향성 데이터의 목적은 
**<span style='color:red'>전체적인 패턴을 찾는 것</span>**입니다. 패턴들이 발견된 후 분석가는 이것을 해석할 책임이 있으며, 
이러한 패턴이 유용한지 검사해야 합니다. 이러한 유형에는 **연관규칙**과 **군집화** 등이 있습니다.

## 3단계:데이터에 대한 지식을 얻는다.

모형을 만들기 전 **<span style='color:red'>데이터를 검토하는 데 시간을 쓰는 것</span>**을 강조하는 것은 지나치지 않습니다. 이 내용에 대해서 아래에서 살펴보도록 하겠습니다. 

### <span style='color:blue'>분포를 관찰한다.</span>

이 단계에서는 데이터 집합의 변수들에 대한 히스토그램을 살펴봄으로써 무엇을 이야기하고 있는지 파악해야 합니다. 데이터베이스를 살펴볼 때 **데이터 시각화도구**들이 큰 도움이 될 수 있습니다.

### 값을 설명과 비교한다. 

이 과정에서는 각 변수들의 값들을 본 후, 사용 가능한 문서들에서 나온 설명과 비교하는 작업이 주를 이루고 있습니다. 이러한 작업을 통해 종종 설명들이 정확하지 않거나 완성되지 않았음을 알게 됩니다.

### 가정들을 확인한다.

**시각화도구**들을 활용하여 데이터의 가정을 확인해야 합니다.

### 많은 질문을 한다.

데이터가 가지고 있는 의미들을 제대로 표출하지 못하거나. 기대에 못미치면 이를 체크하고, 질문을 해야 합니다.

## 4단계:모형 집합을 생성한다.

**모형 집합**은 하나의 테이블 또는 테이블들의 집합입니다. 테이블이기 때문에 행과 열로 구성되어 있어요. 행은 관심대상으로 이루어졌으며, 열은 대상에 대하여 알려진 속성 필드로 표현할 수 있습니다.

### **<span style='color:blue'>고객 시그니처(Customer signature)</span>**

데이터가 고객들에 관한 것일 때, 모형 집합의 행들은 **고객 시그니처(customer signature)**라고 불리고 있습니다.

### **<span style='color:blue'>균형표본(balanced sample)</span>**의 생성

모형의 균형화 방법은 크게 두 가지가 있습니다. 먼저, **층화추출(과대 샘플링)**방법이 있습니다. 이 과정은 다른 값에 대하여 동일한 수의 레코드를 갖도록 모형 집합을 
생성하는 것입니다. 두 번째(대안적인) 방법으로 **다른 집단에서 다른 비율로 표본 추출 또는 다른 가중치를 부여**하는 것이 있습니다. 즉, 대다수를 차지하는 다수집단에 대해 소수집단보다 적은 가중치를 두는 방법입니다.

<img width="391" alt="image" src="https://user-images.githubusercontent.com/107903417/231697034-88c6dfb2-209d-41c4-81fe-3a5afcf2ba42.png">

### 예측을 위한 모형 집합의 생성

예측을 할 때 모형은 **과거의 데이터**를 활용하여 미래에 대한 예측을 해야 합니다. 아래 그림과 같이 모형을 만들 때의 시간은 모형을 사용할 때의 시간과 비교되어야 합니다.

<img width="594" alt="image" src="https://user-images.githubusercontent.com/107903417/232224062-b4d4842b-caa3-4a67-8f48-ac2c1ae8a896.png">

### 모형집합의 분할

모형집합은 아래와 같이 세 가지로 분할해야 합니다.
- <span style='color:blue'>훈련 집합(training set)</span>
  - 초기 모형을 만드는 데 활용됨.
- <span style='color:blue'>검증 집합(validation set)</span>
  - 처음의 모형을 보정하고 일반적으로 만들어 훈련데이터의 특성들로부터 구속되지 않도록 만드는 데 활용됨.
- <span style='color:blue'>테스트 집합(test set)</span>
  - 새로운 데이터가 적용되었을 때 모형의 효과를 추정하기 위해 활용됨.

<img width="585" alt="image" src="https://user-images.githubusercontent.com/107903417/232230156-23e7a868-8752-4378-aa5c-b85f0843c9d4.png">

## 5단계:데이터의 문제들을 수정한다.

데이터마이닝에 사용되는 데이터는 모두 깨끗하지 않습니다. 깨끗하지 않은 데이터가 문제가 되는지 여부는 데이터마이닝기법에 따라 달라집니다. 의사결정의 경우,
데이터의 누락이나 이상치 등과 같은 문제가 문제점이 되진 않지만, 인공신경망의 경우 데이터의 문제점이 많은 문제들을 일으키게 됩니다. 이러한 내용에 대해 
아래에서 자세히 살펴볼게요.

### 너무 많은 값을 가진 범주형 변수

우편번호, 카운티, 전화번호, 휴대전화 기종, 코드 등은 모두 유용한 정보를 내포하고 있지만, 이 변수들이 가질 수 있는 값은 너무 다양하기 때문에 이러한 변수들은
이들이 내포한 가치 있는 정보들과 함께 버려집니다. 이러한 변수들은 **집단화(Grouping)**을 하던지, 흥미로운 속성들로 대체되어야 합니다. 

### 비대칭 분포나 이상치를 가진 숫자 변수

보통 이상치를 가진 레코드들을 버리는 것이 바람직한 방법으로 여겨지고 있습니다. 비대칭 분포의 숫자변수의 경우, 정규화를 통해 값의 범위를 변환시키거나 로그값으로 
대체하는 방법을 사용할 수 있어요.

### <span style='color:blue'>결측값(Missing Values)</span>

결측된 정보를 평균이나 중간값과 같은 그럴듯한 값으로 치환하는 것은 결국 가짜 정보를 가져오게 되는 결과를 초래합니다. 만약 결측된 값들이 대체되어야 한다면 누락된 값을 목표변수로 하는 모형을 만들어 그 결과를 사용하는 것입니다.

## 6단계:정보를 표면에 내놓도록 데이터를 변환시킨다.

데이터를 수집하고, 데이터의 문제점들이 해결된 후에도, 분석을 위한 준비가 필요합니다. 이에 대한 자세한 내용은 아래와 같습니다.
- **<span style='color:blue'>경향성</span>**을 파악한다.
  - 이 과정에서는 **장기적인** 경향성을 파악하기 위해 유도 변수를 추가해야 합니다. 유도변수의 예는 이번 달의 소비/지난 달의 소비 등과 같습니다.
- **<span style='color:blue'>비율</span>**과 다른 변수들의 조합을 생성한다.
  - 이 과정에서는 여러 변수를 조합하는 작업이 수행됩니다. PE=주가/수익, 그리고 인구밀도=인구/면적 등과 같은 것이 여러 변수의 조합의 예시입니다.
- 개수, 금액이 그 자체로 흥미롭지 않은 경우가 많음.
  - 이러한 변수는 다른 변수들의 영향을 받습니다. 즉, 대가족 또는 소가족의 일용품 소비액과 같이 다른 변수와 결합될 때 흥미로운 변수가 된다는 의미입니다.
- <span style='color:blue'>빈도수</span>를 **<span style='color:blue'>비율</span>**로 정의한다.
  - 예시로는 가정의 제품군별 소비 금액을 비율로 나타낸 것 등이 있어요.

## 7단계:모형들을 생성한다.

이 단계는 데이터마이닝 기법에 따라 다른데, 크게 아래와 같이 두 가지로 나눠서 살펴볼 수 있어요.
- 방향성 데이터마이닝(지도학습)
  - 훈련 집합으로 모델링을 실시함.
  - 인공신경망, 의사결정나무, 그리고 연결 그래프 등이 이에 해당됨.
- 무방향성 데이터마이닝(비지도학습)
  - 목표변수가 없음.
  - 연관규칙, 군집 분석 등이 이에 해당됨.

## 8단계:모형들을 평가한다.

이 단계는 모형이 제대로 작동하는지 여부를 평가하며, 아래와 같은 질문들에 답을 할 수 있어야 합니다.
- 모형이 얼마나 정확한가?
- 모형이 관찰된 데이터를 얼마나 잘 설명하는가?
- 모형의 예측에 대해 얼마나 자신할 수 있는가?
- 모형이 얼마나 이해하기 좋은가?

### 출력변수를 예측시 관심있는 출력

출력변수를 예측할 때 관심있는 출력을 크게 아래와 같이 세 가지로 나눠서 살펴볼 수 있어요.
- 예측된 수치값 : 출력변수가 **수치값**일 때(예:주택가격)
- 예측된 클래스 소속도 : 출력변수가 **범주값**일 때(예:구매자와 비구매자)
- 경향 : 출력변수가 **범주값**일 때 클래스 소속도의 확률(예:채무 불이행 경향)

### 예측 성능의 평가
- Notation = \\[y: 실제값, \hat{y}:예측값, n:데이터 수\\]
- MPE(Mean Percentage Error, 평균 백분율 오차) = \\[{100\over n}\Sigma({y-\hat{y}\over y})\\]
- MAPE(Mean Absolute Percentage Error, 평균 절대비율 오차) = \\[{100\over n}\Sigma(\|y-\hat{y}\|\over y)\\]

### 향상차트(Lift Chart, 이익 도표)
- 기저리프트값(baseline lift) = \\[전체 반응 데이터 수\over 전체 데이터 수\\]
  - 모든 데이터 중에서 실제로 반응한 데이터의 비율
  - 랜덤모델은 모든 분위의 반응률이 기저리프트와 같음.
- 반응검출률(% captured response) = \\[분위 내 반응 데이터 수\over 전체 반응 데이터 수\\]
  - 각 분위별로 전체 반응 데이터에서 얼마나 큰 조각을 가져가는지에 대한 비율
  - 각 분위마다 하나씩 산출하며 분위를 산정하기 전에 데이터셋의 각 관측치에 대한 예측확률을 내림차순으로 정렬
- 반응률(% response) = \\[분위 내 반응 데이터 수\over 전체 데이터 수\div 분위의 개수\\]
  - 각 분위에 대한 데이터 중에서 실제로 반응한 데이터가 얼마나 많은지의 비율
- 리프트값(lift) = \\[분위별 반응률\over (기저리프트값)\\]
  - 각 분위별로 나타나는 반응률이 기저리프트값과 비교할 때 몇 배나 더 큰지에 대한 값

### 분류경향과 컷오프
- 경향(propensities) : 레코드가 각 클래스에 속할 확률
- 컷오프 값은 변경 가능함.




