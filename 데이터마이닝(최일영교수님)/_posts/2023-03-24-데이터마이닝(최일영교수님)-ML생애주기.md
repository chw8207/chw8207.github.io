---
layout: post
title: 3장 데이터마이닝 프로세스
# image: 
#   path: /assets/img/blog/jeremy-bishop@0,5x.jpg
description: >
  데이터마이닝 프로세스 정리 글입니다.
sitemap: false
---

<!-- Version 9 is the most complete version of Hydejack yet.
{:.lead}

[Modernized](#linking-in-style) [design](#whats-in-the-cards), [big headlines](#ready-for-the-big-screen), big new features: [Built-In Search](#built-in-search), [Sticky Table of Contents](#sticky-table-of-contents), and [Auto-Hiding Navbar](#auto-hiding-navbar). That [and more](#and-much-more) is Hydejack 9.

- Table of Contents
{:toc .large-only} -->
## 데이터마이닝 프로세스

데이터마이닝은 **데이터로부터 의미있는 지식을 획득하는** 것을 나타내는 용어입니다. 이러한 데이터마이닝 프로세스는 
아래와 같은 단계로 이루어지고 있습니다. 
1. 데이터의 문제를 포착한다.
2. **<span style='color:red'>데이터를 정보로 변환한다.</span>**
3. 정보에 따라 행동한다. 
4. 결과를 측정한다. 
   
3장에서는 데이터마이닝 문제를 3단계의 관점에서 살펴보고 있었습니다. 3단계는 크게 **가설 검정**, **모형 구축**, 그리고
**패턴 발견** 등의 주제를 포함하고 있습니다. 또한 데이터마이닝의 유형을 3가지로 나눠서 살펴보았는데요, 3가지 유형은 
**가설 검정**, **방향성 데이터마이닝**, 그리고 **무방향성 데이터마이닝**으로 구성되어 있습니다. 

## 무엇이 잘못되었나

데이터마이닝에서 중요한 부분은 다음과 같습니다. 데이터마이닝은 의사결정을 내리기 위해 **<span style='color:red'>과거</span>**를 
통해 학습한다는 것입니다. 하지만 데이터마이닝을 통해 아래와 같은 좋지 않은 결과들이 나올 수 있습니다. 
- 사실이 아닌 것을 학습하는 경우
- 사실이지만 유용하지 않은 것을 학습하는 경우(뻔한 결과)

### 사실이 아닌 것을 학습하는 경우

사실이 아닌 것을 학습하는 경우는 유용하지 않은 것보다 위험한데, 잘못된 정보를 바탕으로 의사결정이 이루어질 수 있기 때문이라고 해요.
발견된 패턴들은 경영 의사결정의 반영 외 역할은 없을 수 있고, 요약의 경우는 숨겨진 정보를 파괴하거나 숨길 수 있습니다. 그럼 이러한 경우
초래되는 결과가 어떤 것이 있는지 알아보도록 할게요.

#### 파악된 패턴들이 **<span style='color:red'>실제 존재하는 규칙을 표현</span>**하지 않을 수 있다.

이러한 경우는 **데이터 자체가 명확하지 않거나 데이터가 문제와 관련없을 때** 발생하게 됩니다. 
데이터마이너들에게 주어지는 과제는 **<span style='color:red'>예측력이 있는 패턴과 없는 패턴</span>**을 구분하는 것입니다. 
예를 들어 미국에서 스포츠 경기에서 어느 팀이 이기면 특정 정당이 우수하다고 예측한 것은 인과관계가 없기 때문에 예측적 가치가 없습니다. 
여기서 나오는 중요한 개념이 있는데 그것은 바로 **과적합(overfitting)**입니다. 과적합은 일반화에 실패한 패턴을 찾아내는 것을 가리킵니다. 
과적합은 특정 데이터만 신경쓰기 때문에 어떨 때는 잘 작동하고, 어떨 때는 작동하지 않는 불안정한 모델이 되는 원인이 됩니다. 

#### 데이터 집합이 올바른 모집단을 반영하지 않을 수 있다. 

**데이터(모델) 집합**은 데이터마이닝 모형들을 개발하는 데 쓰는 **<span style='color:red'>과거 데이터</span>**의 모음입니다. 
또한 여기서 **편향(bias)**개념이 나오게 됩니다. **편향**은 모집단을 제대로 반영하지 않는 표본을 말합니다. 편향된 데이터를 사용하게 되면
사실이 아닌 것을 학습하게 되는 결과를 초래하게 됩니다. 따라서 **<span style='color:red'>데이터 선택</span>**과 **<span style='color:red'>샘플링</span>**이
중요합니다. 

#### **<span style='color:red'>데이터의 상세화 수준</span>**이 잘못되었을 수 있다.

이 부분에 대해서는 사례와 함께 살펴보도록 할게요.
<img width="563" alt="image" src="https://user-images.githubusercontent.com/107903417/229336935-20551d2e-3116-4a87-b11a-bf9394aa865f.png">

이 그림은 무선 전화 가입자의 월별 사용량을 나타내는 그래프입니다. 그래프를 보면 서비스 종료 전인 8월부터 사용량이 감소하는 패턴을 보인다라고 
해석할 수 있습니다. 하지만 월별 사용량 대신 일별 사용량으로 본다면 다른 결과가 나올 것입니다. 

<img width="464" alt="image" src="https://user-images.githubusercontent.com/107903417/229337221-90fe595f-6a04-467c-9676-a542c48526c9.png">

이 그래프는 데이터의 합산(aggregate)를 통해 발생하는 혼란의 예시를 보여주는 그래프입니다. 이를 토대로 10월에 영업실적이 급감한 것으로 해석할 수 있습니다.
하지만 2003년 10월 공휴일과 주말이 몰려서 개장을 하지 않았기 때문에 이와 같은 모습으로 나타나게 되었습니다. 이 두 사례를 통해 **데이터 상세화 수준**의
중요성에 대해 알 수 있습니다.

### 사실이지만 유용하지 않은 것을 학습하는 경우
이 경우는 아래와 같은 두 가지로 나눠서 살펴볼 수 있습니다. 

#### 이미 알려진 것을 학습하는 경우(뻔한 것)
이 경우는 '배달불가 지역에 거주하는 사람들은 신문을 구독하지 않는다'와 같이 이미 알고 있는 것을 패턴으로 인식하는 경우입니다.
종종 가장 확연한 패턴들은 업무 규칙들을 반영하고 있습니다. 이 말이 이해가 잘 되지 않으실 텐데요, 데이터마이닝이 
**익명 전화차단을 활용하는 사람들이 발신자 표시 서비스 역시 사용한다**는 것을 **발견**한다는 것이 이러한 사례입니다. 
이러한 패턴들은 흥미롭지 않고, 덜 분명한 패턴들보다도 중요하지 않다는 특징을 보여줍니다.

#### **<span style='color:red'>사용할 수 없는 것들을 학습</span>**하는 경우
이 경우는 **규제**와 **회사에서 통제하는 범위를 벗어날 때** 발생합니다. 이러한 경우에 대해 아래서 살펴보도록 하겠습니다. 
- 규제의 경우 아래와 같은 사례를 통해 부정적인 영향을 끼친다는 것을 알 수 있습니다. 
  - 무선통신과 유선통신 : 무선통시 회사가 유선 서비스를 제공하는 것이 제도적으로 금지였음.
  - 신용이력을 기초로 한 보험계약 여부 : 법적으로 금지됨.
- 회사에서 통제할 수 있는 범위를 벗어난 경우의 사례는 아래와 같습니다. 
  - 제품이 특정 날씨에 더 적합 : 날씨를 바꿀 수 없음
  - 지형의 영향 : 지형도 바꿀 수 없음 

또다른 데이터마이닝이 쓸모없게 되는 이유로 **<span style='color:red'>상상력의 결핍</span>**이 있습니다. 

## 데이터마이닝 스타일

데이터마이닝에는 다음과 같이 세 가지의 스타일이 포함되어 있는데, 하나씩 살펴보려고 합니다. 
- 가설검정
  - 질문에 대한 답을 얻거나 이해를 위해서 데이터를 사용하는 것
- 방향성 데이터마이닝
  - 목표변수를 설명하거나 예측하기 위한 모형을 구축하는 것
  - 방향성은 **<span style='color:red'>지도학습</span>**이라고 생각하면 됨.
  - 즉, 종속(목표)변수가 존재할 때 사용되는 방법임.
- 무방향성 데이터마이닝
  - 특정 목표변수에 얽매이는 대신, 전체적인 패턴을 발견하는 것
  - 무방향성은 **<span style='color:red'>비지도학습</span>**이라고 생각하면 됨.
  - 즉, input변수만 있을 때 사용되는 방법임.

### 가설 검증

데이터마이너는 두 가지 접근법 사이를 오가며 작업하는 데, 하나는 **가설 생성**이고, 다른 하나는 
**가설 검증**입니다. 
- 가설의 생성 : 관찰된 행위에 대한 가한 설명을 생각하고, 데이터로 분석할 수 있는 가설을 수립
- 가설 검증 : 데이터를 통해 검증할 가설을 제안(가설 확인)

여기서 말하는 **가설**은 데이터의 분석을 통해 타당성이 검증될 수 있는 제시된 설명입니다. 
가설의 또다른 정의는 일련의 현상을 설명하기 위해 어떤 학설을 논리적으로 구성하는 명제입니다.

### 가설 검증과 실험

가장 기본적인 실험 설계는 **<span style='color:red'>두 집단의 생성</span>**을 포함하고 있습니다. 
두 집단은 아래와 같습니다. 
- 테스트 집단(test group) 또는 조치 집단(treatment group) : 어떤 종류의 조치를 받는 집단
- 통제 집단(controp group) : 조치를 받지 않는 집단

#### A/B테스트(쌍대 테스트)

**A/B테스트는** 변화가 없는 기존 요소로 구성된 A안과 변화를 적용한 B안을 비교하여 어느 것이 더 나은 성과를 나타내는지 
측정하는 실험을 가리킵니다. 이 때 두 집단에게 다른 조치가 취해집니다.(어떤 집단은 A, 다른 집단은 B에 노출됨) 그러니까 
다른 광고 메세지에 노출되는 것이 다른 조치에 해당된다는 거지요. 이러한 A/B테스트는 웹사이트, 광고, 이메일 등을 대상으로 
진행되고 있어요.

### 방향성 데이터마이닝(지도학습)

방향성 데이터마이닝은 **<span style='color:red'>목표변수</span>**에 초점이 맞춰져 있으며, 과거 데이터들은 모두 
목표변수의 값을 가지고 있어야 합니다. 방향성 데이터의 목적은 **<span style='color:red'>목표변수를 설명하는 패턴을 찾는 것</span>**이에요.

### 무방향성 데이터마이닝(비지도학습)

무방향성 데이터마이닝은 **목표변수를 사용하지 않는(적어도 명시적으로)** 유형을 가리킵니다. 무방향성 데이터의 목적은 
**<span style='color:red'>전체적인 패턴을 찾는 것</span>**입니다. 패턴들이 발견된 후 분석가는 이것을 해석할 책임이 있으며, 
이러한 패턴이 유용한지 검사해야 합니다. 이러한 유형에는 **연관규칙**과 **군집화** 등이 있습니다.

## 데이터마이닝 작업들

데이터마이닝에서 작업들은 아래와 같습니다.
- 데이터 준비
- 탐색적 데이터 분석(기술통계)
- 이분 응답 모델링(이분 분류)
- 이산형 값에 대한 분류&예측
- 수치값에 대한 추정
- 군집분석과 연관성
- 새로운 데이터에 모형 적용


### 데이터 준비

데이터 준비 작업은 대부분의 마이닝 경우에 필요하며, 데이터마이닝 프로젝트에서 일반적으로 시간이 많이 소요되는 작업입니다. 다음 내용에 대해 살펴보기 전
**고객 시그니처**에 대해 잠깐 살펴보고 가겠습니다. 
- 고객 시그니처(signature)
  - 한 고객에 대하여 한 레코드가 생성됨.
  - 관심이 있는 모든 것을 담기 위해 많은 수의 필드들을 가짐.

## 데이터마이닝을 통해 수행할 수 있는 작업들

데이터마이닝을 통해 수행할 수 있는 작업들에 대해 아래에서 살펴보고 넘어가겠습니다. 

### 분류(classification)

분류는 **<span style='color:red'>새로 나타난 대상</span>**들의 **<span style='color:red'>특징들</span>**을 살펴보고, 사전에 정의된 **<span style='color:red'>분류</span>** 집단에 할당하는 작업입니다. 분류작업의 특징으로는 클래스들에 대한 사전에 명확한 정의가 존재하며, 미리 분류된 예로 구성된 **<span style='color:red'>훈련 집단</span>**을 가진다는 것이며, **오분류표**를 활용한다는 특징이 있습니다. 세분화와 다르게 분류는 **기준이 미리 있다**는 점에서 차이가 있습니다. 분류를 활용하는 알고리즘의 예로는 **SVM**, **로지스틱회귀**, 그리고 **인공신경망** 등이 있습니다.

### 추정

**분류**는 '예'와 '아니오'처럼 이산형 값을 출력하는 반면, **추정**은 **연속형 값**을 가지는 결과를 다루고 있습니다. 즉, 추정변수의 타겟변수는 **숫자**라는 것을 의마하는 
것이라는 것을 알 수 있어요. 이러한 추정은 **분류** 작업에도 활용되고 있습니다.

### 예측

예측은 **미래행위를 분류**하거나 **미래 값을 추정**할 때 활용되고 있습니다. 예측은 입력변수와 출력변수의 **<span style='color:blue'>순차적(temporal)</span>** 관계를 
고려한다는 특징을 갖고 있어요.

### 유사성 집단화(연관성 규칙)

연관성 규칙을 적용할 때 먼저 어떤 일들이 **<span style='color:blue'>함께</span>** 일어나는지를 판단하면서 시작합니다. 그 후, **장바구니 분석**을 진행합니다. 마지막으로
분석을 통해 얻은 데이터로부터 **<span style='blue'>규칙</span>**을 생성합니다. 

### 군집화

**군집화**는 이질적인 모집단으로부터 다수의 동질적인 하위집단 또는 **<span style='color:blue'>군집</span>**들로 세분화하는 작업입니다. 군집화가 분류와 다른 점은 
**사전에 정의된 클래스와 분류된 예시**가 없다는 것입니다. 군집화에서 레코드들은 **<span style='color:blue'>상호 유사성</span>**에 근거하여 함께 그룹화가 되고 있어요. 
군집화는 다른 형태의 데이터마이닝 또는 모델링의 사전 작업으로 활용될 수 있습니다.

### 프로파일링

고객, 상품, 업무프로세스 등에 무슨 일이 일어나는지에 대한 **이해(understanding)**을 높이는 방법으로 데이터마이닝을 사용할 수 있습니다.

### 데이터마이닝 기법

데이터마이닝은 모형을 만드는 데 사용되고 있습니다. 여기서 '스코어링'개념이 등장하게 됩니다. **<span style='color:red'>스코어링(scoring)</span>**은 
모형을 새 데이터에 적용하는 것을 의미합니다. 이러한 모형의 사용 목적은 아래와 같습니다. 
- 의사결정을 가이드하는 데 사용될 수 있는 스코어 생성
- 설명변수들과 목표변수 간의 관계에 관한 통찰 제공
  
<img width="397" alt="image" src="https://user-images.githubusercontent.com/107903417/230628907-81df661d-6f32-4f79-9041-b14cdc6ee7d1.png">

이러한 모형을 만들기 위한 데이터집합이 있는데, 이를 **<span style='color:blue'>모형 집합(Model Set)</span>**이라고 합니다. 모형 집합은 아래와 같이
3가지로 나눠지게 됩니다. 
- 훈련집합(training set) : 모형들을 만들기 위해 활용됨.
- 검증집합(validation set) : 모형들의 최상의 것을 선택하기 위해 활용됨.
- 테스트집합(test set) : 모형의 성능을 평가하기 위해 활용됨.

### 어떤 작업에 어떤 기법이 사용되었나?

우리는 작업을 할 때 다양한 데이터마이닝 기법을 사용할 수 있습니다. 어떠한 기법을 사용할지에 대한 판단 기준은 아래와 같고, 이를 참고하여 
적절한 기법을 선택해야 합니다.
- 목표변수가 1개인지 1개 이상인지
- 목표(입력)변수 데이터의 형태
- 사용하기 쉬운 것의 중요도
- 설명력이 얼마나 중요한가
  - 의사결정나무는 설명력이 좋은 반면, 인공신경망은 설명력 부분이 부족함.

### 데이터마이닝 프레임워크

데이터마이닝의 전반적인 프레임워크를 그림으로 표현하면 아래와 같습니다. 

<img width="599" alt="image" src="https://user-images.githubusercontent.com/107903417/230699802-8a0de08e-60dd-4ea7-83a6-673e770d43af.png">

### 데이터마이닝 분류

데이터마이닝은 크게 **지도학습**과 **비지도학습**으로 분류할 수 있는데, 자세한 내용은 아래와 같습니다.
- 지도학습(supervised learning)
  - 분류/예측 하고자 하는 종속 변수가 존재할 경우 이를 반응변수로 설정하고, 독립변수와의 관계를 모델링하는 기법
  - 학습 데이터로부터 모델이 구축되며 결과가 있는 검증 데이터를 사용하여 모델의 성능을 평가하고 비교함.
- 비지도학습(unsupervised learning)
  - 예측/분류 하고자 하는 변수가 없어 자율적으로 모델이 완성되가는 기법
  - 데이터 내 연관규칙을 찾고, 비슷한 관측치를 군집화하며 차원을 축소하는 데 활용됨.

### 데이터마이닝 프로세스 

#### CRISP-DM

데이터마이닝 프로세스 기법으로 많이 사용되고 있는 것은 IBM의 SPSS에서 제시하는 **CRISP-DM**입니다. 이 기법은 총 6단계로 나눠져 있는데, 
아래에서 자세히 살펴볼게요.
1. 비즈니스의 이해
   - 기업의 특성을 파악하는 단계
   - 각종 자료와 워크숍 등을 통해 해당 기업의 비즈니스 운영 특징을 면밀히 파악함.
2. 데이터 이해
   - 기업의 특성을 파악하는 단계
   - DB의 구조, 변수 종류 및 의미, 레코드 수, 그리고 데이터 품질 등을 면밀히 파악함.
3. 데이터 준비
   - 분석을 위한 데이터 추출&정제
   - 데이터를 실제로 분석할 수 있는 상태로 변환(파생변수 생성 등)
4. 모델링
   - 분석 데이터를 바탕으로 용도에 맞는 데이터마이닝 기법 적용하여 모델링
5. 평가
   - 모형 성능 비교 재현 가능성 판단, 현실적 운용 가능성 검토 등 프로젝트 목적에 가장 적합한 모델 선정
6. 전개
   - 모델을 실무 운영가능한 형태로 개발하여 전개하는 단계

#### SEMMA(sample, explore, modify, model, access)

SEMMA기법은 SAS에서 제시하는 데이터마이닝 프로세스에요. 이 기법은 제목에서 알 수 있듯이 5개로 나눠서 살펴볼 수 있는데, 그 중 **표본추출**, **데이터 탐색**,
그리고 **모형 평가**에 대해 살펴보겠습니다.
1. 표본추출(Sampling) 
  - 표본의 종류는 아래와 같이 세 가지로 구성되어 있어요.
    - 학습 데이터 표본(Training data set) : 모형을 적합하기 위해 사용되는 데이터 샘플
    - 평가 데이터 표본(Validation data set) : 하이퍼파라미터를 미세조정할 때 사용
    - 검증 데이터 표본(Test data set) : 최종 모델을 평가할 때 사용
  
  - 샘플링 방법론
  
   1) 단순무작위 표본추출법
   
      - 일정 수의 표본을 무작위로 추출하는 방법
      - 모집단 구성원이 표본으로 추출될 확률을 계산할 수 있으며 이러한 확률은 모두 동일함.
  
   2) 체계적 표본추출법
   
      - 추출단위에 일련번호를 부여받아 이를 등간격으로 나눈 후, 첫 구간에서 하나의 번호를 무작위로 선정함. 그 다음 등간격으로 다음 번호들을 계속해서 추출해나감.
      - 무작위로 설정된 표본프레임과 적절한 추출간격을 선택하는 것이 중요함.
  
   3) 층화 표본추출법
   
      - 모집단을 특정 기준에 따라 **서로 상이한 소집단**으로 나눈 후 소집단으로부터 일정 수의 표본을 **무작위**로 추출하는 방법
      - 단순무작위 표본추출법의 단점인 **표본의 편중될 가능성**을 보완함으로써 대표성을 확보할 수 있음.
  
   4) 군집 표본추출법
   
      - 모집단을 군집으로 나누고 하나(또는 일정 수)의 군집을 무작위로 추출한 후, 추출된 군집 내에서 모든 구성원들을 조사하는 방법
     
2. 데이터 탐색(Explore)
   - 데이터 탐색은 데이터에 포함된 변수들이 어떤 분포를 하고 있으며, 변수들 간의 관계를 파악하는 작업임.
   - **데이터 변환(Modification)및 변수 선정**은 분석의 목적에 적합한 형태로 데이터를 변환해주는 작업입니다.
   - 데이터의 척도도 중요한 개념인데, 척도를 구분하여 정리한 내용은 아래 그림에 나온 표와 같습니다. 
   
   <img width="503" alt="image" src="https://user-images.githubusercontent.com/107903417/230725828-397c7436-dc87-4fa4-95b5-1e7cabd34e33.png">

3. 모형 평가(Assessment)

모형 평가에서는 평가에 사용되는 지표에 대해 살펴보겠습니다. 평가 지표는 **범주형**인지 아니면 **숫자형(수치형)**인지에 따라 사용되는 것이 다릅니다. 
그럼 각각의 변수에 어떠한 지표가 사용되는지 살펴보겠습니다. 

1) 범주형 변수

범주형 변수에서 핵심은 **오분류표**를 활용한다는 것입니다. 오분류표는 아래와 같이 구성되어 있습니다. 

![image](https://user-images.githubusercontent.com/107903417/230726971-753c7211-ad39-4861-994a-9d09fd570b06.png)

오분류표를 이용하여 구할 수 있는 평가지표와 공식은 아래와 같습니다. 
- 정확도(정밀도, Precision) = \\[TP\over TP+FP\\]
- 민감도(Sensitivity) 또는 재현율(Recall) = \\[TP\over TP+FN\\]
- 특이도(Specificity) = \\[TN\over FP+TN\\]
- 정분류율(Accuracy) = \\[TP+TN\over TP+TN+FP+FN\\]
- 오분류율(Error rate) = \\[1-TP+TN\over TP+TN+FP+FN\\]
- F1_score = \\[2\times Precision\times Recall\over Precision+Recall\\]

위 지표 외 범주형 변수에서 많이 쓰이고 있는 평가지표에서 중요한 개념이 있는데 바로 **ROC커브**입니다. RCO커브는 x축이 **1-특이도**로, 그리고 y축이
**민감도**로 구성되어 있어요. 여기서 **1-특이도**는 실제 False를 True로 예측하는 것과 관련있습니다. ROC커브와 함께 따라다니는 개념이 있는데요, 그것은 바로
**AUC(Area Under Curve)**입니다. 이름에서 알 수 있듯이 AUC는 RCO커브와 x축이 이루는 넓이를 가리키며, 이 값이 커질수록 성능이 좋다고 할 수 있습니다. 

![image](https://user-images.githubusercontent.com/107903417/230727391-3bed5bf1-694b-42ef-8fc1-7c151c5d1cc7.png)

2) 수치형 변수

수치형 변수에서 사용되는 평가지표는 아래와 같이 두 가지가 있습니다. 
- MAE(Mean Absolute Error)은 실제값과 예측값의 차이의 절댓값을 구해 이를 평균화한 값으로, 값이 작을수록 성능이 좋습니다. 
- MAE = \\[\Sigma|y_{i}-y_{i}\hat|\over N\\]
- RMSE는 평균제곱근 오차(편차)를 가리키는 용어입니다.
- RMSE = \\[\sqrt{\Sigma(y_{i}-y\hat_{i})^2\over N}\\]
